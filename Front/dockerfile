# Etapa 1: Construir o frontend
FROM node:18 AS build
WORKDIR /app

# Definir a vari√°vel de ambiente no build
ENV VITE_BACKEND_API=https://back-gestao-escala.fly.dev

COPY package.json ./
RUN npm install --legacy-peer-deps
COPY . .
RUN npx vite --version
RUN npm run build

# Etapa 2: Criar a imagem final
FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html

ENV PORT=8080
EXPOSE $PORT

CMD echo "Iniciando Nginx na porta $PORT" && sed -i "s/80/$PORT/g" /etc/nginx/conf.d/default.conf && nginx -g "daemon off;"